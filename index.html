<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Fun Math Practice for Kids</title>
  <style>
    body {
      background-color: #f0f8ff;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #ff4500;
    }
    .scoreboard {
      margin-bottom: 20px;
    }
    #progressContainer {
      width: 80%;
      background-color: #ddd;
      border-radius: 10px;
      margin: 10px auto;
      height: 20px;
      overflow: hidden;
    }
    #progressBar {
      height: 100%;
      width: 0;
      background-color: #32cd32;
    }
    .problem-container {
      background-color: #fffacd;
      border: 2px solid #ffa500;
      border-radius: 10px;
      padding: 20px;
      display: inline-block;
      margin-top: 20px;
    }
    .input-container {
      margin: 15px 0;
    }
    input[type="number"] {
      padding: 10px;
      font-size: 16px;
      width: 150px;
      text-align: center;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #ff4500;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px;
    }
    button:hover {
      background-color: #ff6347;
    }
    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }
    .message {
      font-size: 18px;
      font-weight: bold;
      margin-top: 10px;
    }
    .help-message {
      font-size: 16px;
      color: #00008B;
      margin-top: 10px;
      text-align: left;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body>
  <h1>Welcome to Fun Math Practice!</h1>
  <p>Practice your math skills with interactive problems!</p>
  
  <div class="scoreboard">
    <p id="scoreDisplay">Score: 0</p>
    <p id="questionDisplay">Question: 0 / 10</p>
    <div id="progressContainer">
      <div id="progressBar"></div>
    </div>
  </div>
  
  <div class="problem-container">
    <p id="problem">Press ENTER after typing your answer to begin!</p>
    <div class="input-container">
      <label for="answer"><strong>Your Answer:</strong></label><br>
      <input type="number" id="answer" placeholder="Type a number" autocomplete="off">
    </div>
    <!-- Help buttons and Reset button -->
    <button id="helpButton" onclick="showHelp()">Help</button>
    <button id="moreHelpButton" onclick="showAlternateHelp()" style="display: none;">More Help</button>
    <button id="resetButton" onclick="resetSession()" disabled>Reset Session</button>
    <p class="message" id="message"></p>
    <p class="help-message" id="helpMessage"></p>
    <p class="help-message" id="altHelpMessage"></p>
  </div>
  
  <script>
    let correctAnswer = 0;
    let totalQuestions = 10;
    let questionsCompleted = 0;
    let questionAttempts = 0; // Tracks attempts for the current question (max 3)
    let score = 0;
    // Store current problem values for help hints
    let currentNum1 = 0;
    let currentNum2 = 0;
    let currentOperator = "";
    
    // Update scoreboard and progress bar
    function updateScoreboard() {
      document.getElementById("scoreDisplay").innerText = `Score: ${score}`;
      document.getElementById("questionDisplay").innerText = `Question: ${questionsCompleted} / ${totalQuestions}`;
      const progressPercent = (questionsCompleted / totalQuestions) * 100;
      document.getElementById("progressBar").style.width = progressPercent + "%";
    }
    
    // Generate a new math problem and reset per-question attempts and help messages
    function generateProblem() {
      if (questionsCompleted >= totalQuestions) {
        endSession();
        return;
      }
      
      // Clear previous messages, help hints, and reset the input and attempts for this question
      document.getElementById("message").innerText = "";
      document.getElementById("helpMessage").innerHTML = "";
      document.getElementById("altHelpMessage").innerHTML = "";
      document.getElementById("answer").value = "";
      document.getElementById("moreHelpButton").style.display = "none";
      questionAttempts = 0;
      
      // Generate two random numbers between 1 and 20
      currentNum1 = Math.floor(Math.random() * 20) + 1;
      currentNum2 = Math.floor(Math.random() * 20) + 1;
      
      // Randomly choose an operator: +, -, or *
      const operators = ["+", "-", "*"];
      currentOperator = operators[Math.floor(Math.random() * operators.length)];
      
      let problemText = "";
      if (currentOperator === "+") {
        correctAnswer = currentNum1 + currentNum2;
        problemText = `${currentNum1} + ${currentNum2} = ?`;
      } else if (currentOperator === "-") {
        if (currentNum1 < currentNum2) {
          correctAnswer = currentNum2 - currentNum1;
          problemText = `${currentNum2} - ${currentNum1} = ?`;
        } else {
          correctAnswer = currentNum1 - currentNum2;
          problemText = `${currentNum1} - ${currentNum2} = ?`;
        }
      } else if (currentOperator === "*") {
        correctAnswer = currentNum1 * currentNum2;
        problemText = `${currentNum1} * ${currentNum2} = ?`;
      }
      
      document.getElementById("problem").innerText = problemText;
    }
    
    // Check the user's answer when ENTER is pressed
    function checkAnswer() {
      if (questionsCompleted >= totalQuestions) return;
      
      const answerInput = document.getElementById("answer");
      const userAnswer = parseInt(answerInput.value);
      const messageEl = document.getElementById("message");
      
      if (isNaN(userAnswer)) {
        messageEl.innerText = "Please enter a valid number. ðŸ¤”";
        messageEl.style.color = "red";
        return;
      }
      
      if (userAnswer === correctAnswer) {
        score++;
        messageEl.innerText = "Correct! Great job! ðŸ˜Š";
        messageEl.style.color = "green";
        questionsCompleted++;
        updateScoreboard();
        setTimeout(generateProblem, 1500);
      } else {
        questionAttempts++;
        if (questionAttempts < 3) {
          messageEl.innerText = `Incorrect. Try again! (${questionAttempts} of 3 attempts used) ðŸ˜ž`;
          messageEl.style.color = "red";
        } else {
          messageEl.innerText = `No more attempts! The correct answer was ${correctAnswer}.`;
          messageEl.style.color = "red";
          questionsCompleted++;
          updateScoreboard();
          setTimeout(generateProblem, 2000);
        }
      }
    }
    
    // Display a detailed, step-by-step help hint based on the current problem.
    // Also reveals the "More Help" button.
    function showHelp() {
      if (questionsCompleted >= totalQuestions) return;
      let helpText = "";
      
      if (currentOperator === "+") {
        helpText = `Step-by-Step for Addition:<br>
1. Start with the first number: <strong>${currentNum1}</strong>.<br>
2. Count up one by one until you've added <strong>${currentNum2}</strong> numbers.<br>
&nbsp;&nbsp;&nbsp;&nbsp;Example: For <strong>${currentNum1} + ${currentNum2}</strong>, start at ${currentNum1}, then ${currentNum1 + 1}, ${currentNum1 + 2}, etc.<br>
3. The final number you reach is the answer.`;
      } else if (currentOperator === "-") {
        const larger = Math.max(currentNum1, currentNum2);
        const smaller = Math.min(currentNum1, currentNum2);
        helpText = `Step-by-Step for Subtraction:<br>
1. Identify the larger number (<strong>${larger}</strong>) and the smaller number (<strong>${smaller}</strong>).<br>
2. Count backwards from the larger number until you've subtracted <strong>${smaller}</strong>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;Example: For <strong>${larger} - ${smaller}</strong>, count: ${larger - 1}, ${larger - 2}, etc.<br>
3. The final number is the answer.`;
      } else if (currentOperator === "*") {
        helpText = `Step-by-Step for Multiplication:<br>
1. Understand that <strong>${currentNum1} * ${currentNum2}</strong> means adding one number repeatedly.<br>`;
        if (currentNum1 === 2 || currentNum2 === 2) {
          const other = currentNum1 === 2 ? currentNum2 : currentNum1;
          helpText += `2a. <strong>Trick:</strong> Multiplying by 2 is just doubling the other number. For example, ${currentNum1} * ${currentNum2} equals double ${other} (i.e. ${other * 2}).<br>`;
        }
        helpText += `2. Write it out as repeated addition. For example, add ${currentNum1} together ${currentNum2} times (or vice versa).<br>
3. The total sum is your answer.`;
      }
      document.getElementById("helpMessage").innerHTML = helpText;
      // Reveal the More Help button for an alternate explanation
      document.getElementById("moreHelpButton").style.display = "inline-block";
    }
    
    // Provide an alternate, creative explanation for the current problem.
    function showAlternateHelp() {
      if (questionsCompleted >= totalQuestions) return;
      let altHelpText = "";
      
      if (currentOperator === "+") {
        altHelpText = `Alternate Help for Addition:<br>
Imagine a number line. Place a marker on <strong>${currentNum1}</strong> and take <strong>${currentNum2}</strong> steps to the right. Each step adds one. The spot where you land is the answer.`;
      } else if (currentOperator === "-") {
        altHelpText = `Alternate Help for Subtraction:<br>
Visualize a countdown. If you have <strong>${currentNum1}</strong> items and lose <strong>${currentNum2}</strong> of them, remove items one by one until you see what remains.`;
      } else if (currentOperator === "*") {
        altHelpText = `Alternate Help for Multiplication:<br>
Think of multiplication as grouping. If you have ${currentNum1} groups of ${currentNum2} items (or vice versa), draw each group and then count all the items together.<br>`;
        if (currentNum1 === 2 || currentNum2 === 2) {
          const other = currentNum1 === 2 ? currentNum2 : currentNum1;
          altHelpText += `Remember: Multiplying by 2 is just doubling the number: double ${other} is ${other * 2}.`;
        }
      }
      document.getElementById("altHelpMessage").innerHTML = altHelpText;
    }
    
    // End the session, disable input and help buttons, enable reset, and show a cool math fact.
    function endSession() {
      document.getElementById("answer").disabled = true;
      document.getElementById("helpButton").disabled = true;
      document.getElementById("moreHelpButton").disabled = true;
      document.getElementById("resetButton").disabled = false;
      const messageEl = document.getElementById("message");
      messageEl.innerHTML = "Session complete! ðŸŽ‰<br>Cool Fact: Math is like a superpowerâ€”its patterns and logic help us understand the universe. Keep practicing to unlock even more wonders!";
      messageEl.style.color = "#00008B";
      document.getElementById("problem").innerText = "Well done! Press Reset to start a new session.";
    }
    
    // Reset the session to start over.
    function resetSession() {
      questionsCompleted = 0;
      score = 0;
      document.getElementById("answer").disabled = false;
      document.getElementById("helpButton").disabled = false;
      document.getElementById("moreHelpButton").disabled = false;
      document.getElementById("resetButton").disabled = true;
      updateScoreboard();
      document.getElementById("message").innerText = "";
      document.getElementById("helpMessage").innerHTML = "";
      document.getElementById("altHelpMessage").innerHTML = "";
      generateProblem();
    }
    
    // Listen for the ENTER key on the input field to automatically check the answer
    document.getElementById("answer").addEventListener("keydown", function(e) {
      if (e.key === "Enter") {
        checkAnswer();
      }
    });
    
    // Generate the first problem when the page loads
    window.onload = generateProblem;
  </script>
</body>
</html>
