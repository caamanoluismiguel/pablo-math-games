<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FunMath4Pablo.com</title>
  <!-- Import Montserrat font from Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* Global Styles */
    body {
      margin: 0;
      font-family: 'Montserrat', sans-serif;
      overflow-x: hidden;
      background: #fff;
    }
    a { text-decoration: none; }
    
    /* Top Section (Hero) */
    #topSection {
      background-color: #F4C37D; /* Warm yellow-orange */
      color: #000;
      padding: 60px 20px;
      text-align: center;
      position: relative;
      animation: fadeIn 1s ease-in;
    }
    #topSection .logo {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 2em;
      font-weight: bold;
    }
    #topSection h1 {
      margin: 0;
      font-size: 3em;
      font-weight: bold;
    }
    #topSection p {
      font-size: 1.5em;
      margin: 20px 0 0 0;
      font-style: italic;
    }
    
    /* Bottom Section (Interactive Content) */
    #bottomSection {
      background-color: #333333; /* Dark background */
      color: white;
      padding: 40px 20px;
      animation: fadeIn 1s ease-in;
    }
    .scoreboard {
      margin-bottom: 20px;
      font-size: 1.2em;
    }
    #timeDisplay {
      font-weight: bold;
    }
    #progressContainer {
      width: 80%;
      background-color: #555;
      border-radius: 10px;
      margin: 10px auto;
      height: 20px;
      overflow: hidden;
    }
    #progressBar {
      height: 100%;
      width: 100%; /* starts full */
      background-color: #32cd32;
      transition: background-color 0.5s, width 1s;
    }
    .problem-container {
      background-color: #444;
      border: 2px solid #FFA500;
      border-radius: 10px;
      padding: 20px;
      margin: 20px auto;
      max-width: 600px;
    }
    #problem {
      font-size: 2em;
      font-weight: bold;
      margin-bottom: 15px;
    }
    .input-container {
      margin: 15px 0;
    }
    input[type="number"] {
      padding: 10px;
      font-size: 18px;
      width: 150px;
      text-align: center;
      border: none;
      border-radius: 5px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #FFA500;
      color: #000;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px;
    }
    button:hover {
      background-color: #e69500;
    }
    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }
    .message, .help-message {
      font-size: 18px;
      font-weight: bold;
      margin-top: 10px;
    }
    .help-message {
      text-align: left;
      max-width: 600px;
      margin: 10px auto;
      color: #FFD700; /* Light gold for contrast */
    }
    /* Log Display Area */
    #logDisplay {
      margin-top: 20px;
      text-align: left;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      background: #222;
      padding: 10px;
      border-radius: 5px;
      display: none;
      color: white;
    }
    
    /* Fade In Animation */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body>
  <!-- Top Section / Hero -->
  <section id="topSection">
    <div class="logo">âˆš</div>
    <h1>FunMath4Pablo.com ê’°(Ë¶â€¢ á´— â€¢Ë¶)ê’±</h1>
    <p>"So, whether you eat or drink, or whatever you do, do it all for the glory of God." â€“ 1 Corinthians 10:31</p>
  </section>
  
  <!-- Bottom Section / Interactive Content -->
  <section id="bottomSection">
    <div class="scoreboard">
      <p id="scoreDisplay">Score: 0</p>
      <p id="questionDisplay">Questions: 0</p>
      <p id="timeDisplay">Time Left: 15:00</p>
      <div id="progressContainer">
        <div id="progressBar"></div>
      </div>
    </div>
    
    <div class="problem-container">
      <p id="problem">Press ENTER after typing your answer to begin!</p>
      <div class="input-container">
        <label for="answer"><strong>Your Answer:</strong></label><br>
        <input type="number" id="answer" placeholder="Type a number" autocomplete="off">
      </div>
      <!-- Help, More Help, Reset, and Logs Toggle Buttons -->
      <button id="helpButton" onclick="showHelp()">Help</button>
      <button id="moreHelpButton" onclick="showAlternateHelp()" style="display: none;">More Help</button>
      <button id="resetButton" onclick="resetSession()" disabled>Reset Session</button>
      <button id="logsButton" onclick="toggleSessionLogs()">Show Session Logs</button>
      <p class="message" id="message"></p>
      <p class="help-message" id="helpMessage"></p>
      <p class="help-message" id="altHelpMessage"></p>
    </div>
    
    <!-- Div to display session logs -->
    <div id="logDisplay"></div>
  </section>
  
  <script>
    // Session settings
    const sessionDuration = 15 * 60; // 15 minutes in seconds
    let remainingTime = sessionDuration;
    let timerInterval;
    
    // Session state variables
    let correctAnswer = 0;
    let questionsCompleted = 0;
    let questionAttempts = 0; // Up to 3 attempts per question
    let score = 0;
    // Variables for current problem values
    let currentNum1 = 0;
    let currentNum2 = 0;
    let currentOperator = "";
    
    // Returns an interpolated color between green and red based on ratio (1 = full time left)
    function getProgressColor(ratio) {
      const startColor = { r: 50, g: 205, b: 50 }; // green (#32cd32)
      const endColor = { r: 255, g: 0, b: 0 };      // red (#FF0000)
      let r = Math.round(startColor.r + (endColor.r - startColor.r) * (1 - ratio));
      let g = Math.round(startColor.g + (endColor.g - startColor.g) * (1 - ratio));
      let b = Math.round(startColor.b + (endColor.b - startColor.b) * (1 - ratio));
      return `rgb(${r}, ${g}, ${b})`;
    }
    
    // Update the timer display and progress bar
    function updateTimeDisplay() {
      const minutes = Math.floor(remainingTime / 60);
      const seconds = remainingTime % 60;
      const formattedSeconds = seconds < 10 ? "0" + seconds : seconds;
      document.getElementById("timeDisplay").innerText = `Time Left: ${minutes}:${formattedSeconds}`;
      
      const timePercent = (remainingTime / sessionDuration) * 100;
      const progressBar = document.getElementById("progressBar");
      progressBar.style.width = timePercent + "%";
      progressBar.style.backgroundColor = getProgressColor(remainingTime / sessionDuration);
    }
    
    // Start the 15-minute session timer
    function startTimer() {
      updateTimeDisplay();
      timerInterval = setInterval(() => {
        remainingTime--;
        updateTimeDisplay();
        if (remainingTime <= 0) {
          clearInterval(timerInterval);
          endSession();
        }
      }, 1000);
    }
    
    // Update scoreboard (score and questions attempted)
    function updateScoreboard() {
      document.getElementById("scoreDisplay").innerText = `Score: ${score}`;
      document.getElementById("questionDisplay").innerText = `Questions: ${questionsCompleted}`;
    }
    
    // Generate a new math problem and reset per-question state
    function generateProblem() {
      if (remainingTime <= 0) return;
      
      document.getElementById("message").innerText = "";
      document.getElementById("helpMessage").innerHTML = "";
      document.getElementById("altHelpMessage").innerHTML = "";
      document.getElementById("answer").value = "";
      document.getElementById("moreHelpButton").style.display = "none";
      questionAttempts = 0;
      
      currentNum1 = Math.floor(Math.random() * 20) + 1;
      currentNum2 = Math.floor(Math.random() * 20) + 1;
      
      const operators = ["+", "-", "*"];
      currentOperator = operators[Math.floor(Math.random() * operators.length)];
      
      let problemText = "";
      if (currentOperator === "+") {
        correctAnswer = currentNum1 + currentNum2;
        problemText = `${currentNum1} + ${currentNum2} = ?`;
      } else if (currentOperator === "-") {
        if (currentNum1 < currentNum2) {
          correctAnswer = currentNum2 - currentNum1;
          problemText = `${currentNum2} - ${currentNum1} = ?`;
        } else {
          correctAnswer = currentNum1 - currentNum2;
          problemText = `${currentNum1} - ${currentNum2} = ?`;
        }
      } else if (currentOperator === "*") {
        correctAnswer = currentNum1 * currentNum2;
        problemText = `${currentNum1} * ${currentNum2} = ?`;
      }
      
      document.getElementById("problem").innerText = problemText;
    }
    
    // Check the user's answer when ENTER is pressed
    function checkAnswer() {
      if (remainingTime <= 0) return;
      
      const answerInput = document.getElementById("answer");
      const userAnswer = parseInt(answerInput.value);
      const messageEl = document.getElementById("message");
      
      if (isNaN(userAnswer)) {
        messageEl.innerText = "Please enter a valid number. ðŸ¤”";
        messageEl.style.color = "red";
        return;
      }
      
      if (userAnswer === correctAnswer) {
        score++;
        messageEl.innerText = "Correct! Great job! ðŸ˜Š";
        messageEl.style.color = "green";
        questionsCompleted++;
        updateScoreboard();
        setTimeout(generateProblem, 1000);
      } else {
        questionAttempts++;
        if (questionAttempts < 3) {
          messageEl.innerText = `Incorrect. Try again! (${questionAttempts} of 3 attempts used) ðŸ˜ž`;
          messageEl.style.color = "red";
        } else {
          messageEl.innerText = `No more attempts! The correct answer was ${correctAnswer}.`;
          messageEl.style.color = "red";
          questionsCompleted++;
          updateScoreboard();
          setTimeout(generateProblem, 1500);
        }
      }
    }
    
    // Show a simple, kid-friendly help explanation for the current problem.
    function showHelp() {
      if (remainingTime <= 0) return;
      let helpText = "";
      
      if (currentOperator === "+") {
        helpText = `Addition Help:<br>
Imagine you have one pile with ${currentNum1} items and another with ${currentNum2} items. Put them together to get the total.`;
      } else if (currentOperator === "-") {
        helpText = `Subtraction Help:<br>
Imagine you have ${currentNum1} items and you remove ${currentNum2} of them. The items left are your answer.`;
      } else if (currentOperator === "*") {
        helpText = `Multiplication Help:<br>
Think of it as making groups. For <strong>${currentNum1} Ã— ${currentNum2}</strong>, imagine having ${currentNum1} groups with ${currentNum2} items in each. Add all the items together.`;
      }
      
      document.getElementById("helpMessage").innerHTML = helpText;
      document.getElementById("moreHelpButton").style.display = "inline-block";
    }
    
    // Show an alternate visual explanation chosen at random.
    function showAlternateHelp() {
      if (remainingTime <= 0) return;
      let altHelpText = "";
      
      if (currentOperator === "+") {
        altHelpText = `Alternate Addition Help:<br>
Imagine a number line starting at ${currentNum1}; move right by ${currentNum2} steps. The number you land on is your total.`;
      } else if (currentOperator === "-") {
        altHelpText = `Alternate Subtraction Help:<br>
Picture having ${currentNum1} cookies and eating ${currentNum2} of them. Count what remains.`;
      } else if (currentOperator === "*") {
        const altHelpOptions = [
          `Imagine ${currentNum1} baskets, each with ${currentNum2} apples. Count the apples basket by basket.`,
          `Picture ${currentNum1} rows of stars with ${currentNum2} stars each. Add up the stars in each row.`,
          `Think of ${currentNum1} groups of balloons, each holding ${currentNum2} balloons. Count them group by group.`
        ];
        let randomIndex = Math.floor(Math.random() * altHelpOptions.length);
        altHelpText = `Alternate Multiplication Help:<br>` + altHelpOptions[randomIndex];
      }
      
      document.getElementById("altHelpMessage").innerHTML = altHelpText;
    }
    
    // Log the session details (date, score, questions attempted) in localStorage.
    function logSession() {
      const sessionLog = {
        date: new Date().toLocaleString(),
        score: score,
        questionsAttempted: questionsCompleted
      };
      let logs = JSON.parse(localStorage.getItem('sessionLogs')) || [];
      logs.push(sessionLog);
      localStorage.setItem('sessionLogs', JSON.stringify(logs));
      console.log("Session logged:", sessionLog);
    }
    
    // End the session: stop timer, disable inputs, log session, and show final message.
    function endSession() {
      clearInterval(timerInterval);
      document.getElementById("answer").disabled = true;
      document.getElementById("helpButton").disabled = true;
      document.getElementById("moreHelpButton").disabled = true;
      document.getElementById("resetButton").disabled = false;
      const messageEl = document.getElementById("message");
      messageEl.innerHTML = `Session complete! ðŸŽ‰<br>
Your score: ${score}<br>
Questions attempted: ${questionsCompleted}<br>
Cool Fact: Practice makes you faster at math!`;
      messageEl.style.color = "#FFD700";
      document.getElementById("problem").innerText = "Time's up! Press Reset to start a new session.";
      logSession();
    }
    
    // Toggle display of session logs.
    function toggleSessionLogs() {
      let logDiv = document.getElementById("logDisplay");
      let logsButton = document.getElementById("logsButton");
      if (logDiv.style.display === "none" || logDiv.innerHTML.trim() === "") {
        let logs = JSON.parse(localStorage.getItem('sessionLogs')) || [];
        let displayHTML = "<h2>Session Logs</h2>";
        if (logs.length === 0) {
          displayHTML += "<p>No logs available.</p>";
        } else {
          logs.forEach(log => {
            displayHTML += `<p><strong>Date:</strong> ${log.date}<br>
<strong>Score:</strong> ${log.score}<br>
<strong>Questions Attempted:</strong> ${log.questionsAttempted}</p><hr>`;
          });
        }
        logDiv.innerHTML = displayHTML;
        logDiv.style.display = "block";
        logsButton.textContent = "Hide Session Logs";
      } else {
        logDiv.style.display = "none";
        logsButton.textContent = "Show Session Logs";
      }
    }
    
    // Reset the session: reinitialize state, timer, and UI elements.
    function resetSession() {
      questionsCompleted = 0;
      score = 0;
      remainingTime = sessionDuration;
      document.getElementById("answer").disabled = false;
      document.getElementById("helpButton").disabled = false;
      document.getElementById("moreHelpButton").disabled = false;
      document.getElementById("resetButton").disabled = true;
      updateScoreboard();
      updateTimeDisplay();
      document.getElementById("message").innerText = "";
      document.getElementById("helpMessage").innerHTML = "";
      document.getElementById("altHelpMessage").innerHTML = "";
      clearInterval(timerInterval);
      startTimer();
      generateProblem();
    }
    
    // Listen for the ENTER key on the answer input field.
    document.getElementById("answer").addEventListener("keydown", function(e) {
      if (e.key === "Enter") {
        checkAnswer();
      }
    });
    
    // Start the session when the page loads.
    window.onload = function() {
      startTimer();
      generateProblem();
    };
  </script>
</body>
</html>
